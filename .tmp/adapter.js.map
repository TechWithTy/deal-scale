{
  "version": 3,
  "sources": ["../tests/setup/test-framework-adapter.ts"],
  "sourcesContent": ["import type { Mock, MockInstance } from \"vitest\";\r\n\r\n/**\r\n * Provides a Jest-compatible global that forwards to Vitest utilities when\r\n * Jest is not the active runner. This allows the existing Jest-oriented test\r\n * suites to execute under Vitest without code edits, while preserving native\r\n * behaviour when running within Jest.\r\n */\r\n\r\ntype UnknownFn = (...args: unknown[]) => unknown;\r\ntype MaybeMock<T extends UnknownFn> = MockInstance<T> | Mock<T>;\r\ntype MockFactory = () => Record<string, unknown>;\r\n\r\nconst moduleMockRegistry = new Map<string, unknown>();\r\nconst isVitest = () => typeof globalThis.vi !== \"undefined\";\r\n\r\nconst resolveExistingJest = () => {\r\n\tif (typeof globalThis.jest !== \"undefined\") {\r\n\t\treturn globalThis.jest;\r\n\t}\r\n\r\n\tconst globalRequire = (() => {\r\n\t\ttry {\r\n\t\t\t// eslint-disable-next-line no-eval\r\n\t\t\treturn eval(\"require\") as ((path: string) => unknown) | undefined;\r\n\t\t} catch {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t})();\r\n\r\n\tif (typeof globalRequire === \"function\") {\r\n\t\ttry {\r\n\t\t\tconst { jest } = globalRequire(\"@jest/globals\") as {\r\n\t\t\t\tjest?: typeof globalThis.jest;\r\n\t\t\t};\r\n\t\t\treturn jest;\r\n\t\t} catch {\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t}\r\n\r\n\treturn undefined;\r\n};\r\n\r\nconst createVitestFacade = () => {\r\n\tconst vi = globalThis.vi as typeof import(\"vitest\").vi | undefined;\r\n\tconst expect = globalThis.expect as typeof globalThis.expect | undefined;\r\n\r\n\tif (!vi || !expect) {\r\n\t\tthrow new Error(\r\n\t\t\t\"Vitest globals were not detected. Ensure Vitest runs with the --globals flag.\",\r\n\t\t);\r\n\t}\r\n\r\n\tconst fn = <T extends UnknownFn>(impl?: T) => vi.fn(impl);\r\n\tconst mocked = <T>(item: T) => vi.mocked(item);\r\n\r\n\tconst mock = (\r\n\t\tmodulePath: string,\r\n\t\tfactory?: MockFactory,\r\n\t\toptions?: { virtual?: boolean },\r\n\t) => {\r\n\t\tif (factory) {\r\n\t\t\tvi.mock(\r\n\t\t\t\tmodulePath,\r\n\t\t\t\t() => {\r\n\t\t\t\t\tconst mockedModule = factory();\r\n\t\t\t\t\tmoduleMockRegistry.set(modulePath, mockedModule);\r\n\t\t\t\t\treturn mockedModule;\r\n\t\t\t\t},\r\n\t\t\t\toptions,\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvi.mock(modulePath, factory as never, options);\r\n\t};\r\n\r\n\tconst requireActual = <T = unknown>(modulePath: string): T => {\r\n\t\tthrow new Error(\r\n\t\t\t\"jest.requireActual is not supported by the Vitest compatibility shim. Import the module directly instead.\",\r\n\t\t);\r\n\t};\r\n\r\n\tconst requireMock = <T = unknown>(modulePath: string): T => {\r\n\t\tif (moduleMockRegistry.has(modulePath)) {\r\n\t\t\treturn moduleMockRegistry.get(modulePath) as T;\r\n\t\t}\r\n\r\n\t\tthrow new Error(\r\n\t\t\t\"Module has not been registered via jest.mock(). Provide a factory when mocking under Vitest so the adapter can expose it synchronously.\",\r\n\t\t);\r\n\t};\r\n\r\n\tconst resetRegistry = () => moduleMockRegistry.clear();\r\n\r\n\treturn {\r\n\t\tmock,\r\n\t\tmocked,\r\n\t\trequireActual,\r\n\t\trequireMock,\r\n\t\tresetModules: () => {\r\n\t\t\tresetRegistry();\r\n\t\t\tvi.resetModules();\r\n\t\t},\r\n\t\tsetTimeout: vi.setTimeout.bind(vi),\r\n\t\tclearAllMocks: () => {\r\n\t\t\tresetRegistry();\r\n\t\t\tvi.clearAllMocks();\r\n\t\t},\r\n\t\tresetAllMocks: () => {\r\n\t\t\tresetRegistry();\r\n\t\t\tvi.resetAllMocks();\r\n\t\t},\r\n\t\trestoreAllMocks: () => {\r\n\t\t\tresetRegistry();\r\n\t\t\tvi.restoreAllMocks();\r\n\t\t},\r\n\t\tuseFakeTimers: vi.useFakeTimers.bind(vi),\r\n\t\tuseRealTimers: vi.useRealTimers.bind(vi),\r\n\t\trunOnlyPendingTimers: vi.runOnlyPendingTimers.bind(vi),\r\n\t\tadvanceTimersByTime: vi.advanceTimersByTime.bind(vi),\r\n\t\tclearAllTimers: vi.clearAllTimers.bind(vi),\r\n\t\tspyOn: vi.spyOn.bind(vi),\r\n\t\tfn,\r\n\t\texpect,\r\n\t};\r\n};\r\n\r\nconst jestLike = (() => {\r\n\tif (!isVitest()) {\r\n\t\tconst existing = resolveExistingJest();\r\n\t\tif (!existing) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t\"Neither Jest nor Vitest detected. Unified test framework adapter requires one of them.\",\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (typeof globalThis.jest === \"undefined\") {\r\n\t\t\tglobalThis.jest = existing as typeof globalThis.jest;\r\n\t\t}\r\n\r\n\t\treturn existing;\r\n\t}\r\n\r\n\treturn createVitestFacade();\r\n})();\r\n\r\nif (typeof globalThis.jest === \"undefined\") {\r\n\tglobalThis.jest = jestLike as typeof globalThis.jest;\r\n}\r\n\r\nconsole.info(\"[test-framework-adapter] loaded\", {\r\n\tisVitest: typeof globalThis.vi !== \"undefined\",\r\n\tjestDefined: typeof globalThis.jest !== \"undefined\",\r\n});\r\n\r\nexport const testFramework = jestLike;\r\n"],
  "mappings": "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",
  "names": []
}
